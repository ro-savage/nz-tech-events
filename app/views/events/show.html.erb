<% content_for :title, "#{@event.title} - NZ Tech Events" %>

<a href="<%= root_path %>" class="back-link">&larr; Back to Events</a>

<% unless @event.approved? %>
  <div class="alert alert-warning" role="alert">
    <strong>‚è≥ Pending Approval</strong><br>
    This event is awaiting admin approval and is not yet visible in the public events list. 
    <% if Current.user&.admin? %>
      <a href="<%= admin_pending_events_path %>" class="underline">Go to pending events</a>
    <% end %>
  </div>
<% end %>

<article class="event-detail">
  <header>
    <span class="<%= event_type_badge_class(@event.event_type) %>">
      <%= @event.event_type.titleize %>
    </span>
    <span class="badge <%= @event.free? ? 'badge-free' : 'badge-paid' %>">
      <%= @event.cost.presence || "Free" %>
    </span>

    <h1><%= @event.title %></h1>
  </header>

  <div class="event-details">
    <div>
      <strong>Date</strong><br>
      <%= @event.formatted_date %>
      <% if @event.formatted_time %>
        &bull; <%= @event.formatted_time %>
      <% end %>
    </div>

    <div>
      <strong>Location<%= @event.multi_location? ? "s" : "" %></strong><br>
      <% @event.event_locations.each do |loc| %>
        <%= loc.full_display %><br>
      <% end %>
      <% if @event.address.present? %>
        <span class="text-muted text-sm"><%= @event.address %></span>
      <% end %>
    </div>

    <div class="calendar-links">
      <strong>Add to Calendar</strong>
      <a href="<%= google_calendar_url(@event) %>" target="_blank" rel="noopener noreferrer" class="calendar-link">
        Google Calendar
      </a>
      <span class="text-muted">&bull;</span>
      <a href="<%= ical_event_path(@event) %>" class="calendar-link">
        Apple / Outlook (.ics)
      </a>
    </div>
  </div>

  <hr>

  <div class="event-description">
    <%= simple_format(@event.description) %>
  </div>

  <hr>

  <% if @event.registration_url.present? %>
    <div>
      <a href="<%= @event.registration_url %>" target="_blank" rel="noopener noreferrer" role="button" type="button">
        Register / Get Tickets &rarr;
      </a>
    </div>
  <% end %>

  <footer>
    <small class="text-muted">
      Posted by <a href="<%= user_path(@event.user) %>"><%= @event.user.display_name %></a>
      on <%= @event.created_at.strftime("%d %B %Y") %>
    </small>

    <% if @event.editable_by?(Current.user) %>
      <div class="mt-2 flex gap-1">
        <a href="<%= edit_event_path(@event) %>" role="button" type="button" class="outline">Edit</a>
        <%= button_to "Delete", event_path(@event),
            method: :delete,
            data: { turbo_confirm: "Are you sure you want to delete this event?" },
            class: "outline secondary" %>
      </div>
    <% end %>
  </footer>
</article>
