<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= content_for(:title) || "NZ Tech Events - Find Tech Events in New Zealand" %></title>
    <meta name="description" content="<%= content_for(:description) || 'Discover and share tech events across New Zealand. Conferences, meetups, workshops, and more.' %>">

    <!-- Open Graph -->
    <meta property="og:title" content="<%= content_for(:title) || 'NZ Tech Events' %>">
    <meta property="og:description" content="<%= content_for(:description) || 'Discover and share tech events across New Zealand.' %>">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìÖ</text></svg>">

    <!-- Pico CSS - Classless CSS Framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.pink.min.css">

    <!-- Custom styles -->
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <!-- Theme initialization (prevent flash) -->
    <script>
      (function() {
        const saved = localStorage.getItem('theme');
        if (saved) {
          document.documentElement.setAttribute('data-theme', saved);
        }
      })();
    </script>

    <!-- Importmaps for JS (no build!) -->
    <%= javascript_importmap_tags %>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
  </head>

  <body>
    <header class="container site-header">
      <nav>
        <ul>
          <li><a href="<%= root_path %>" class="brand">NZ Tech Events</a></li>
        </ul>

        <!-- Primary nav items (visible on desktop) -->
        <ul class="nav-primary">
          <li><a href="<%= root_path %>" class="nav-link">Upcoming Events</a></li>
          <li><a href="<%= new_email_subscription_path %>" class="nav-link">Subscribe</a></li>
          <% if logged_in? %>
            <li><a href="<%= new_event_path %>" role="button" type="button" class="btn-primary">Post Event</a></li>
          <% else %>
            <li><a href="<%= new_registration_path %>" role="button" type="button" class="btn-primary">Post Event</a></li>
          <% end %>
        </ul>

        <!-- Hamburger button -->
        <button class="hamburger" aria-label="Toggle menu" onclick="toggleMobileMenu()">
          <span class="hamburger-icon">‚ò∞</span>
          <span class="hamburger-close">‚úï</span>
        </button>

        <!-- Dropdown menu -->
        <ul class="nav-menu">
          <!-- Mobile only: primary items -->
          <li class="mobile-only"><a href="<%= root_path %>" class="nav-link">Upcoming Events</a></li>
          <li class="mobile-only"><a href="<%= new_email_subscription_path %>" class="nav-link">Subscribe</a></li>
          <li class="mobile-only">
            <% if logged_in? %>
              <a href="<%= new_event_path %>" class="nav-link">Post Event</a>
            <% else %>
              <a href="<%= new_registration_path %>" class="nav-link">Post Event</a>
            <% end %>
          </li>
          <li class="mobile-only menu-divider"></li>

          <!-- All screens: secondary items -->
          <li><a href="<%= past_events_path %>" class="nav-link">Past Events</a></li>
          <% if logged_in? %>
            <li><a href="<%= my_events_events_path %>" class="nav-link">My Events</a></li>
            <% if Current.user.admin? %>
              <li>
                <a href="<%= admin_pending_events_path %>" class="nav-link">
                  Pending Events
                  <% if pending_events_count && pending_events_count > 0 %>
                    <span class="badge badge-other" style="margin-left: 0.25rem; font-size: 0.75rem; padding: 0.125rem 0.5rem;">
                      <%= pending_events_count %>
                    </span>
                  <% end %>
                </a>
              </li>
              <li><a href="<%= users_path %>" class="nav-link">Users</a></li>
            <% end %>
          <% end %>
          <li><a href="<%= about_path %>" class="nav-link">About</a></li>
          <% if logged_in? %>
            <li><%= link_to "Sign Out", logout_path, class: "nav-link", data: { turbo_method: :delete } %></li>
          <% else %>
            <li><a href="<%= new_session_path %>" class="nav-link">Sign In</a></li>
          <% end %>
          <li class="menu-divider"></li>
          <li class="nav-theme">
            <button class="theme-toggle" aria-label="Toggle theme" onclick="toggleTheme()">
              <span class="theme-icon-light">‚òÄÔ∏è</span>
              <span class="theme-icon-dark">üåô</span>
            </button>
          </li>
        </ul>
      </nav>
    </header>

    <main class="container">
      <% if notice.present? %>
        <div class="alert alert-success" role="alert">
          <%= notice %>
        </div>
      <% end %>
      <% if alert.present? %>
        <div class="alert alert-error" role="alert">
          <%= alert %>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <footer class="container site-footer">
      <small>Free. <a href="https://github.com/ro-savage/nz-tech-events">Open Source</a>. No Ads. No Tracking. <a href="<%= about_path %>">Built for Good</a>.</small>
      <br>
      <small><a href="<%= new_email_subscription_path %>">Subscribe to Weekly Email Updates</a></small>
    </footer>

    <script>
      function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      }

      function toggleMobileMenu() {
        const nav = document.querySelector('.site-header nav');
        nav.classList.toggle('menu-open');
      }

      // Close menu when clicking a link
      document.querySelectorAll('.nav-menu a, .nav-menu button[type="submit"]').forEach(function(link) {
        link.addEventListener('click', function() {
          document.querySelector('.site-header nav').classList.remove('menu-open');
        });
      });

      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        const nav = document.querySelector('.site-header nav');
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        if (nav.classList.contains('menu-open') &&
            !hamburger.contains(e.target) &&
            !navMenu.contains(e.target)) {
          nav.classList.remove('menu-open');
        }
      });
    </script>
  </body>
</html>
